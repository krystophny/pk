[packages.linux-headers]
version = "6.18.7"
version_check = "kernel:"
description = "Linux kernel headers"
source_pkg = "linux"
stage = 1
build_order = 3
build_commands = [
    "make mrproper && make headers && find usr/include -type f ! -name '*.h' -delete && mkdir -p ${PKG}/usr/include && cp -rv usr/include/* ${PKG}/usr/include/"
]

# Glibc pass 1 - built with cross-compiler (temporary)
# Build order: 4 (requires gcc-pass1 + linux-headers)

[packages.libstdcxx-pass1]
version = "16-20260118"
version_check = "gcc-snapshot:"
description = "GNU Standard C++ Library (cross-built)"
source_pkg = "gcc"
stage = 1
build_order = 5
depends = ["glibc-pass1"]
build_commands = [
    "mkdir -p build && cd build && ../libstdc++-v3/configure --host=${TARGET} --build=$(../config.guess) --prefix=/usr --disable-multilib --disable-nls --disable-libstdcxx-pch --disable-libstdcxx-sdt --with-gxx-include-dir=/var/tmp/lfs-bootstrap/${TARGET}/include/c++/16.0.1 && make -j${NPROC} && make DESTDIR=${PKG} install && rm -fv ${PKG}/usr/lib/lib{stdc++{,exp,fs},supc++}.la"
]

# Final native libstdc++ (built as part of gcc, but can be built separately)

[packages.libstdcxx]
version = "16-20260118"
version_check = "gcc-snapshot:"
description = "GNU Standard C++ Library"
source_pkg = "gcc"
stage = 3
build_order = 26
build_commands = [
    "mkdir -p build && cd build && ../libstdc++-v3/configure --prefix=/usr --disable-multilib --disable-nls --disable-libstdcxx-pch --with-gxx-include-dir=/usr/include/c++/16.0.1 && make -j${NPROC} && make DESTDIR=${PKG} install",
    "rm -fv ${PKG}/usr/lib/lib{stdc++{,exp,fs},supc++}.la || true"
]

# STAGE 2: Temporary Tools

# GCC Pass 2 - Full cross compiler

[packages.libxcrypt]
version = "4.5.2"
version_check = "github:besser82/libxcrypt"
description = "Modern library for one-way hashing of passwords"
url = "https://github.com/besser82/libxcrypt/releases/download/v${version}/libxcrypt-${version}.tar.xz"
git_url = "https://github.com/besser82/libxcrypt.git"
use_git = false
stage = 3
build_order = 32
build_commands = [
    "./configure --prefix=/usr --enable-hashes=strong,glibc --enable-obsolete-api=glibc --disable-static --disable-failure-tokens",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.libmd]
version = "1.1.0"
version_check = "url:https://libbsd.freedesktop.org/releases/|libmd-[0-9]+\.[0-9]+(\.[0-9]+)?\.tar"
description = "Message digest functions from BSD"
url = "https://libbsd.freedesktop.org/releases/libmd-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/libbsd/libmd.git"
use_git = false
stage = 3
build_order = 26

[packages.libbsd]
version = "0.12.2"
version_check = "url:https://libbsd.freedesktop.org/releases/|libbsd-[0-9]+\.[0-9]+(\.[0-9]+)?\.tar"
description = "BSD portability library"
url = "https://libbsd.freedesktop.org/releases/libbsd-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/libbsd/libbsd.git"
use_git = false
stage = 3
build_order = 27
depends = ["libmd"]

[packages.libcap]
version = "2.77"
version_check = "url:https://git.kernel.org/pub/scm/libs/libcap/libcap.git/refs/|libcap-([0-9]+\\.[0-9]+)"
description = "POSIX capabilities library"
url = "https://git.kernel.org/pub/scm/libs/libcap/libcap.git/snapshot/libcap-${version}.tar.gz"
stage = 3
build_order = 33
build_commands = [
    "sed -i '/install -m.*STA/d' libcap/Makefile",
    "make prefix=/usr lib=lib -j${NPROC}",
    "make prefix=/usr lib=lib DESTDIR=${PKG} install"
]

[packages.libarchive]
version = "3.8.5"
version_check = "github:libarchive/libarchive"
description = "Multi-format archive and compression library"
url = "https://github.com/libarchive/libarchive/releases/download/v${version}/libarchive-${version}.tar.xz"
stage = 4
build_order = 15
depends = ["zlib", "xz", "zstd", "openssl"]
# Use autotools - CMake 4.x compatibility issues
build_commands = [
    "autoreconf -fi",
    "./configure --prefix=/usr --disable-static",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.libtirpc]
version = "1.3.7"
version_check = "sourceforge:libtirpc"
description = "Transport-Independent RPC library"
url = "https://downloads.sourceforge.net/libtirpc/libtirpc-${version}.tar.bz2"
git_url = "https://git.linux-nfs.org/projects/steved/libtirpc.git"
use_git = false
stage = 3
build_commands = [
    "CFLAGS='-std=gnu11' ./configure --prefix=/usr --sysconfdir=/etc --disable-static --disable-gssapi",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.libtasn1]
version = "4.21.0"
version_check = "gnu:libtasn1"
description = "ASN.1 library"
url = "https://ftpmirror.gnu.org/gnu/libtasn1/libtasn1-${version}.tar.gz"
git_url = "https://gitlab.com/gnutls/libtasn1.git"
use_git = false
stage = 4
build_order = 3
configure_flags = "--disable-static"

[packages.libunistring]
version = "1.4.1"
version_check = "gnu:libunistring"
description = "Unicode string library"
url = "https://ftpmirror.gnu.org/gnu/libunistring/libunistring-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/libunistring.git"
use_git = false
stage = 4
build_order = 4
configure_flags = "--disable-static"

[packages.libffi]
version = "3.5.2"
version_check = "github:libffi/libffi"
description = "Foreign function interface library"
url = "https://github.com/libffi/libffi/releases/download/v${version}/libffi-${version}.tar.gz"
git_url = "https://github.com/libffi/libffi.git"
use_git = false
stage = 4
build_order = 5

[packages.libxml2]
version = "2.15.1"
version_check = "gnome:libxml2"
description = "XML parsing library"
url = "https://download.gnome.org/sources/libxml2/2.15/libxml2-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/libxml2.git"
use_git = false
stage = 4
build_order = 8
depends = ["python"]
configure_flags = "--with-python=/usr --with-history"
provides = ["/usr/lib/libxml2.so", "/usr/bin/xmllint"]

[packages.libxmlb]
version = "0.3.21"
version_check = "github:hughsie/libxmlb"
description = "Library to help create and query binary XML blobs"
url = "https://github.com/hughsie/libxmlb/releases/download/${version}/libxmlb-${version}.tar.xz"
stage = 9
depends = ["glib", "libxml2"]
skip_optimization = true
build_commands = [
    "CFLAGS='-O2 -march=znver3 -fno-stack-protector' meson setup build-pk/meson --prefix=/usr -Dgtkdoc=false -Dintrospection=false -Dtests=false",
    "ninja -C build-pk/meson",
    "DESTDIR=${PKG} ninja -C build-pk/meson install"
]
provides = ["/usr/lib/libxmlb.so"]

[packages.libyaml]
version = "0.2.5"
version_check = "github:yaml/libyaml"
description = "YAML parser and emitter library"
url = "https://github.com/yaml/libyaml/releases/download/${version}/yaml-${version}.tar.gz"
source_dir = "yaml-${version}"
stage = 5
provides = ["/usr/lib/libyaml.so"]

[packages.librsvg]
version = "2.61.3"
version_check = "gnome:librsvg"
description = "SVG rendering library (includes gdk-pixbuf SVG loader)"
url = "https://download.gnome.org/sources/librsvg/2.61/librsvg-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/librsvg.git"
use_git = false
stage = 9
build_order = 7
depends = ["gdk-pixbuf", "pango", "cairo", "libxml2", "rust"]
build_system = "meson"
meson_flags = "-Dpixbuf-loader=enabled -Ddocs=disabled -Dintrospection=disabled -Dvala=disabled"
provides = ["/usr/lib/librsvg-2.so", "/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so"]

[packages.libxslt]
version = "1.1.45"
version_check = "gnome:libxslt"
description = "XSLT processing library"
url = "https://download.gnome.org/sources/libxslt/1.1/libxslt-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/libxslt.git"
use_git = false
stage = 4
build_system = "autotools"
depends = ["libxml2"]
configure_flags = "--without-python"
provides = ["/usr/bin/xsltproc", "/usr/lib/libxslt.so"]

[packages.libtiff]
version = "4.7.0"
version_check = "url:https://download.osgeo.org/libtiff/|tiff-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "TIFF image library"
url = "https://download.osgeo.org/libtiff/tiff-${version}.tar.gz"
git_url = "https://gitlab.com/libtiff/libtiff.git"
use_git = false
source_dir = "tiff-${version}"
stage = 8
build_system = "cmake"
cmake_flags = "-DBUILD_SHARED_LIBS=ON -Dtiff-tests=OFF -Dtiff-docs=OFF"
provides = ["/usr/lib/libtiff.so"]

[packages.libtool]
version = "2.5.4"
version_check = "gnu:libtool"
description = "GNU libtool"
url = "https://ftpmirror.gnu.org/gnu/libtool/libtool-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/libtool.git"
use_git = false
stage = 4

[packages.linux]
version = "6.18.7"
version_check = "kernel:"
description = "Linux kernel"
url = "https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-${version}.tar.xz"
git_url = "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git"
use_git = false
checksum_url = "https://cdn.kernel.org/pub/linux/kernel/v6.x/sha256sums.asc"
stage = 5
build_order = 6
depends = ["elfutils"]
build_system = "custom"
build_commands = [
    "make mrproper",
    "make defconfig",
    # Framebuffer and display
    "scripts/config --enable CONFIG_VGA_CONSOLE --enable CONFIG_FRAMEBUFFER_CONSOLE --enable CONFIG_FB --enable CONFIG_FB_EFI --enable CONFIG_FB_VESA --enable CONFIG_DRM --enable CONFIG_DRM_FBDEV_EMULATION --enable CONFIG_DRM_VIRTIO_GPU --disable CONFIG_DRM_NOUVEAU",
    # EFI boot support (critical for UEFI systems)
    "scripts/config --enable CONFIG_EFI --enable CONFIG_EFI_STUB --enable CONFIG_EFI_MIXED --enable CONFIG_EFI_PARTITION --enable CONFIG_EFIVAR_FS --enable CONFIG_EFI_RUNTIME_MAP --enable CONFIG_EFI_BOOTLOADER_CONTROL --enable CONFIG_EFI_VARS_PSTORE --enable CONFIG_EFI_RUNTIME_WRAPPERS",
    # Virtio and storage
    "scripts/config --enable CONFIG_VIRTIO_PCI --enable CONFIG_VIRTIO_MMIO --enable CONFIG_EXT4_FS --enable CONFIG_BLK_DEV_NVME --enable CONFIG_NVME_CORE --enable CONFIG_SATA_AHCI --enable CONFIG_ATA_PIIX",
    # MD RAID support (RAID0, RAID1, RAID10, RAID5/6)
    "scripts/config --enable CONFIG_MD --enable CONFIG_BLK_DEV_MD --enable CONFIG_MD_AUTODETECT --enable CONFIG_MD_RAID0 --enable CONFIG_MD_RAID1 --enable CONFIG_MD_RAID10 --enable CONFIG_MD_RAID456 --enable CONFIG_ASYNC_CORE --enable CONFIG_ASYNC_MEMCPY --enable CONFIG_ASYNC_XOR --enable CONFIG_ASYNC_PQ --enable CONFIG_ASYNC_RAID6_RECOV",
    # Devtmpfs and tmpfs
    "scripts/config --enable CONFIG_DEVTMPFS --enable CONFIG_DEVTMPFS_MOUNT --enable CONFIG_TMPFS",
    # Networking core
    "scripts/config --enable CONFIG_NET --enable CONFIG_INET --enable CONFIG_NETDEVICES --enable CONFIG_VIRTIO_NET --enable CONFIG_E1000 --enable CONFIG_E1000E --enable CONFIG_IGC --enable CONFIG_R8169 --enable CONFIG_REALTEK_PHY",
    # WiFi (Intel AX200/AX210/AX211, regulatory)
    "scripts/config --enable CONFIG_WIRELESS --enable CONFIG_WLAN --enable CONFIG_CFG80211 --enable CONFIG_CFG80211_WEXT --enable CONFIG_MAC80211 --enable CONFIG_IWLWIFI --enable CONFIG_IWLMVM --enable CONFIG_IWLDVM --module CONFIG_IWLWIFI --module CONFIG_IWLMVM",
    # Bluetooth (Intel AX200)
    "scripts/config --enable CONFIG_BT --enable CONFIG_BT_BREDR --enable CONFIG_BT_LE --enable CONFIG_BT_HCIBTUSB --enable CONFIG_BT_HCIUART --enable CONFIG_BT_INTEL --enable CONFIG_BT_BCM --enable CONFIG_BT_RFCOMM --enable CONFIG_BT_HIDP",
    # USB support
    "scripts/config --enable CONFIG_USB --enable CONFIG_USB_XHCI_HCD --enable CONFIG_USB_EHCI_HCD --enable CONFIG_INPUT_EVDEV --enable CONFIG_HID --enable CONFIG_USB_HID --enable CONFIG_HID_LOGITECH --enable CONFIG_HID_LOGITECH_DJ --enable CONFIG_USB_ACM --enable CONFIG_USB_SERIAL --enable CONFIG_USB_SERIAL_GENERIC --enable CONFIG_USB_SERIAL_CH341 --enable CONFIG_USB_SERIAL_FTDI_SIO --enable CONFIG_USB_SERIAL_CP210X",
    # Webcam (Logitech C270 - UVC)
    "scripts/config --enable CONFIG_MEDIA_SUPPORT --enable CONFIG_MEDIA_USB_SUPPORT --enable CONFIG_USB_VIDEO_CLASS --enable CONFIG_USB_VIDEO_CLASS_INPUT_EVDEV --enable CONFIG_VIDEO_DEV --enable CONFIG_VIDEO_V4L2",
    # Firmware loading
    "scripts/config --enable CONFIG_FW_LOADER --set-str CONFIG_EXTRA_FIRMWARE_DIR /lib/firmware",
    # Modules and security
    "scripts/config --enable CONFIG_MODULES --enable CONFIG_MODULE_UNLOAD --enable CONFIG_MODVERSIONS --disable CONFIG_STACKPROTECTOR --disable CONFIG_STACKPROTECTOR_STRONG",
    # Namespaces (for containers, user namespaces, Flatpak, Podman, etc.)
    "scripts/config --enable CONFIG_NAMESPACES --enable CONFIG_USER_NS --enable CONFIG_PID_NS --enable CONFIG_NET_NS --enable CONFIG_UTS_NS --enable CONFIG_IPC_NS --enable CONFIG_CGROUP_NS --enable CONFIG_TIME_NS",
    # CGroups v2 (for Podman, containers)
    "scripts/config --enable CONFIG_CGROUPS --enable CONFIG_CGROUP_SCHED --enable CONFIG_CGROUP_PIDS --enable CONFIG_CGROUP_RDMA --enable CONFIG_CGROUP_FREEZER --enable CONFIG_CGROUP_HUGETLB --enable CONFIG_CGROUP_DEVICE --enable CONFIG_CGROUP_CPUACCT --enable CONFIG_CGROUP_PERF --enable CONFIG_CGROUP_BPF --enable CONFIG_MEMCG --enable CONFIG_BLK_CGROUP --enable CONFIG_CGROUP_WRITEBACK --enable CONFIG_CGROUP_MISC",
    # OverlayFS and FUSE (for Podman, Flatpak)
    "scripts/config --enable CONFIG_OVERLAY_FS --enable CONFIG_FUSE_FS --enable CONFIG_CUSE",
    # Seccomp (for containers, Flatpak, Steam)
    "scripts/config --enable CONFIG_SECCOMP --enable CONFIG_SECCOMP_FILTER",
    # KVM/QEMU virtualization
    "scripts/config --enable CONFIG_VIRTUALIZATION --module CONFIG_KVM --module CONFIG_KVM_AMD --module CONFIG_KVM_INTEL --enable CONFIG_KVM_AMD_SEV --enable CONFIG_HAVE_KVM",
    # VirtIO (for QEMU guests)
    "scripts/config --enable CONFIG_VIRTIO --enable CONFIG_VIRTIO_PCI --enable CONFIG_VIRTIO_BLK --enable CONFIG_VIRTIO_NET --enable CONFIG_VIRTIO_CONSOLE --enable CONFIG_VIRTIO_BALLOON --enable CONFIG_VIRTIO_INPUT --enable CONFIG_VIRTIO_MMIO",
    # VFIO (for GPU passthrough)
    "scripts/config --enable CONFIG_VFIO --enable CONFIG_VFIO_PCI --enable CONFIG_VFIO_IOMMU_TYPE1 --enable CONFIG_VFIO_VIRQFD",
    # BPF (for modern container networking)
    "scripts/config --enable CONFIG_BPF --enable CONFIG_BPF_SYSCALL --enable CONFIG_BPF_JIT",
    # TUN/TAP (for container/VM networking)
    "scripts/config --enable CONFIG_TUN --enable CONFIG_VETH --enable CONFIG_BRIDGE",
    # Netfilter / iptables / nftables (full support for masquerading, NAT, firewall)
    "scripts/config --enable CONFIG_NETFILTER --enable CONFIG_NETFILTER_ADVANCED --enable CONFIG_NETFILTER_XTABLES --enable CONFIG_NF_CONNTRACK --enable CONFIG_NF_NAT --enable CONFIG_NF_DEFRAG_IPV4 --enable CONFIG_NF_DEFRAG_IPV6",
    "scripts/config --enable CONFIG_NETFILTER_XT_MATCH_CONNTRACK --enable CONFIG_NETFILTER_XT_MATCH_STATE --enable CONFIG_NETFILTER_XT_MATCH_COMMENT --enable CONFIG_NETFILTER_XT_MATCH_MULTIPORT --enable CONFIG_NETFILTER_XT_MATCH_LIMIT",
    "scripts/config --enable CONFIG_NETFILTER_XT_TARGET_LOG --module CONFIG_NETFILTER_XT_TARGET_MASQUERADE --enable CONFIG_NETFILTER_XT_TARGET_REDIRECT --enable CONFIG_NETFILTER_XT_NAT",
    "scripts/config --enable CONFIG_IP_NF_IPTABLES --enable CONFIG_IP_NF_FILTER --enable CONFIG_IP_NF_TARGET_REJECT --enable CONFIG_IP_NF_NAT --enable CONFIG_IP_NF_TARGET_MASQUERADE --enable CONFIG_IP_NF_MANGLE --enable CONFIG_IP_NF_RAW",
    "scripts/config --enable CONFIG_IP6_NF_IPTABLES --enable CONFIG_IP6_NF_FILTER --enable CONFIG_IP6_NF_TARGET_REJECT --enable CONFIG_IP6_NF_NAT --enable CONFIG_IP6_NF_MANGLE --enable CONFIG_IP6_NF_RAW",
    "scripts/config --enable CONFIG_NF_TABLES --enable CONFIG_NF_TABLES_INET --enable CONFIG_NFT_NAT --enable CONFIG_NFT_MASQ --enable CONFIG_NFT_REJECT --enable CONFIG_NFT_CT --enable CONFIG_NFT_LOG",
    # Audio (ALSA, HD Audio for AMD Starship + NVIDIA)
    "scripts/config --enable CONFIG_SOUND --enable CONFIG_SND --enable CONFIG_SND_TIMER --enable CONFIG_SND_PCM --enable CONFIG_SND_HRTIMER --enable CONFIG_SND_DYNAMIC_MINORS --enable CONFIG_SND_PCI --enable CONFIG_SND_HDA --enable CONFIG_SND_HDA_INTEL --enable CONFIG_SND_HDA_CODEC_REALTEK --enable CONFIG_SND_HDA_CODEC_HDMI --enable CONFIG_SND_HDA_CODEC_GENERIC --enable CONFIG_SND_USB --enable CONFIG_SND_USB_AUDIO",
    # Low-latency/real-time audio
    "scripts/config --enable CONFIG_PREEMPT --enable CONFIG_PREEMPT_BUILD --enable CONFIG_PREEMPT_COUNT --enable CONFIG_PREEMPTION --enable CONFIG_PREEMPT_DYNAMIC --set-val CONFIG_HZ 1000 --enable CONFIG_HZ_1000 --enable CONFIG_NO_HZ_IDLE --enable CONFIG_NO_HZ_COMMON --enable CONFIG_NO_HZ --enable CONFIG_HIGH_RES_TIMERS --enable CONFIG_CPU_ISOLATION --enable CONFIG_RCU_NOCB_CPU",
    # Crypto support for RAID and filesystems
    "scripts/config --enable CONFIG_CRYPTO --enable CONFIG_CRYPTO_CRC32C --enable CONFIG_CRC32 --enable CONFIG_LIBCRC32C",
    "make olddefconfig",
    "make -j${NPROC}",
    "make INSTALL_MOD_PATH=${PKG} modules_install",
    "mkdir -p ${PKG}/boot ${PKG}/usr/src/linux-${version}",
    "cp arch/x86/boot/bzImage ${PKG}/boot/vmlinuz-${version}",
    "cp System.map ${PKG}/boot/System.map-${version}",
    "cp .config ${PKG}/boot/config-${version}",
    # Install kernel headers for out-of-tree module builds
    "cp -a include ${PKG}/usr/src/linux-${version}/",
    "mkdir -p ${PKG}/usr/src/linux-${version}/arch/x86",
    "cp -a arch/x86/include ${PKG}/usr/src/linux-${version}/arch/x86/",
    "mkdir -p ${PKG}/usr/src/linux-${version}/tools",
    "cp -a scripts ${PKG}/usr/src/linux-${version}/",
    "cp -a tools/objtool ${PKG}/usr/src/linux-${version}/tools/",
    "cp Makefile Kconfig Module.symvers ${PKG}/usr/src/linux-${version}/",
    "mkdir -p ${PKG}/lib/modules/${version}",
    "ln -sf /usr/src/linux-${version} ${PKG}/lib/modules/${version}/build"
]
provides = ["/boot/vmlinuz-${version}"]

[packages.linux-firmware]
version = "20260110"
version_check = "url:https://www.kernel.org/pub/linux/kernel/firmware/|linux-firmware-([0-9]+)\.tar"
description = "Linux kernel firmware files (Intel Wi-Fi, AMD GPU, NVIDIA, i915, etc.)"
url = "https://www.kernel.org/pub/linux/kernel/firmware/linux-firmware-${version}.tar.xz"
git_url = "https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git"
use_git = false
stage = 5
build_order = 5
build_commands = [
    "mkdir -p ${PKG}/lib/firmware",
    "cp -a * ${PKG}/lib/firmware/",
    "rm -rf ${PKG}/lib/firmware/.git"
]
provides = ["/lib/firmware/regulatory.db"]

[packages.lz4]
version = "1.10.0"
version_check = "github:lz4/lz4"
description = "Extremely fast compression algorithm"
url = "https://github.com/lz4/lz4/releases/download/v${version}/lz4-${version}.tar.gz"
git_url = "https://github.com/lz4/lz4.git"
use_git = false
stage = 4
build_commands = [
    "make -j${NPROC} PREFIX=/usr",
    "make PREFIX=/usr DESTDIR=${PKG} install"
]
provides = ["/usr/lib/liblz4.so"]

[packages.libnl]
version = "3.12.0"
version_check = "url:https://github.com/thom311/libnl/tags|libnl([0-9]+)_([0-9]+)_([0-9]+)"
description = "Netlink protocol library suite"
url = "https://github.com/thom311/libnl/releases/download/libnl3_12_0/libnl-${version}.tar.gz"
git_url = "https://github.com/thom311/libnl.git"
use_git = false
stage = 7

[packages.libmnl]
version = "1.0.5"
version_check = "url:https://www.netfilter.org/projects/libmnl/downloads.html|libmnl-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "Minimalistic Netlink library"
url = "https://www.netfilter.org/projects/libmnl/files/libmnl-${version}.tar.bz2"
stage = 7
build_order = 1
provides = ["/usr/lib/libmnl.so"]

[packages.libXau]
version = "1.0.12"
version_check = "xorg:lib/libXau"
description = "X11 authorization protocol library"
url = "https://www.x.org/releases/individual/lib/libXau-${version}.tar.xz"
stage = 7
build_system = "autotools"
depends = ["xorgproto", "util-macros"]

[packages.xtrans]
version = "1.6.0"
version_check = "xorg:lib/libxtrans"
description = "X11 transport library"
url = "https://www.x.org/releases/individual/lib/xtrans-${version}.tar.xz"
stage = 7
build_system = "autotools"
depends = ["util-macros"]

[packages.libX11]
version = "1.8.12"
version_check = "xorg:lib/libX11"
description = "X11 client library"
url = "https://www.x.org/releases/individual/lib/libX11-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libx11.git"
use_git = false
stage = 8
depends = ["libxcb", "libXau", "xtrans", "util-macros", "xorgproto"]

[packages.libXft]
version = "2.3.9"
version_check = "xorg:lib/libXft"
description = "X FreeType library"
url = "https://www.x.org/releases/individual/lib/libXft-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxft.git"
use_git = false
stage = 8

[packages.libXrender]
version = "0.9.12"
version_check = "xorg:lib/libXrender"
description = "X Render extension library"
url = "https://www.x.org/releases/individual/lib/libXrender-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxrender.git"
use_git = false
stage = 8

[packages.libXres]
version = "1.2.3"
version_check = "xorg:lib/libXres"
description = "X Resource extension library"
url = "https://www.x.org/releases/individual/lib/libXres-${version}.tar.xz"
stage = 8
build_system = "autotools"
depends = ["libX11", "libXext"]

[packages.libXrandr]
version = "1.5.5"
version_check = "xorg:lib/libXrandr"
description = "X RandR extension library"
url = "https://www.x.org/releases/individual/lib/libXrandr-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxrandr.git"
use_git = false
stage = 8

[packages.libXinerama]
version = "1.1.6"
version_check = "xorg:lib/libXinerama"
description = "X Xinerama extension library"
url = "https://www.x.org/releases/individual/lib/libXinerama-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxinerama.git"
use_git = false
stage = 8

[packages.libXcursor]
version = "1.2.3"
version_check = "xorg:lib/libXcursor"
description = "X cursor management library"
url = "https://www.x.org/releases/individual/lib/libXcursor-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxcursor.git"
use_git = false
stage = 8

[packages.libXi]
version = "1.8.2"
version_check = "xorg:lib/libXi"
description = "X Input extension library"
url = "https://www.x.org/releases/individual/lib/libXi-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxi.git"
use_git = false
stage = 8

[packages.libXext]
version = "1.3.7"
version_check = "xorg:lib/libXext"
description = "X extension library"
url = "https://www.x.org/releases/individual/lib/libXext-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxext.git"
use_git = false
stage = 8

[packages.libXcomposite]
version = "0.4.7"
version_check = "xorg:lib/libXcomposite"
description = "X Composite extension library"
url = "https://www.x.org/releases/individual/lib/libXcomposite-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxcomposite.git"
use_git = false
stage = 8

[packages.libXdamage]
version = "1.1.7"
version_check = "xorg:lib/libXdamage"
description = "X Damage extension library"
url = "https://www.x.org/releases/individual/lib/libXdamage-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxdamage.git"
use_git = false
stage = 8

[packages.libXfixes]
version = "6.0.2"
version_check = "xorg:lib/libXfixes"
description = "X Fixes extension library"
url = "https://www.x.org/releases/individual/lib/libXfixes-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxfixes.git"
use_git = false
stage = 8

[packages.libxcb]
version = "1.17.0"
version_check = "freedesktop:xorg/lib/libxcb"
description = "X C Binding library"
url = "https://xorg.freedesktop.org/archive/individual/lib/libxcb-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxcb.git"
use_git = false
stage = 8
depends = ["libXau", "libXdmcp", "xcb-proto", "util-macros"]

[packages.libpng]
version = "1.6.54"
version_check = "github:pnggroup/libpng"
description = "PNG image library"
url = "https://downloads.sourceforge.net/libpng/libpng-${version}.tar.xz"
git_url = "https://github.com/pnggroup/libpng.git"
use_git = false
stage = 8

[packages.libjpeg-turbo]
version = "3.1.3"
version_check = "github:libjpeg-turbo/libjpeg-turbo"
description = "JPEG image library with SIMD acceleration"
url = "https://github.com/libjpeg-turbo/libjpeg-turbo/releases/download/${version}/libjpeg-turbo-${version}.tar.gz"
git_url = "https://github.com/libjpeg-turbo/libjpeg-turbo.git"
use_git = false
stage = 8
build_system = "cmake"
cmake_flags = "-DCMAKE_INSTALL_LIBDIR=lib -DENABLE_STATIC=OFF -DWITH_JAVA=OFF"

[packages.libgpg-error]
version = "1.55"
version_check = "url:https://gnupg.org/ftp/gcrypt/libgpg-error/|libgpg-error-([0-9]+\\.[0-9]+)\\.tar"
description = "GnuPG error library"
url = "https://gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-${version}.tar.bz2"
stage = 5
build_commands = [
    "./configure --prefix=/usr",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libgpg-error.so"]

[packages.libassuan]
version = "3.0.2"
version_check = "url:https://gnupg.org/ftp/gcrypt/libassuan/|libassuan-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "IPC library for GnuPG"
url = "https://gnupg.org/ftp/gcrypt/libassuan/libassuan-${version}.tar.bz2"
stage = 5
depends = ["libgpg-error"]
build_commands = [
    "./configure --prefix=/usr",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libassuan.so"]

[packages.libgcrypt]
version = "1.11.0"
version_check = "url:https://gnupg.org/ftp/gcrypt/libgcrypt/|libgcrypt-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "General purpose cryptographic library"
url = "https://gnupg.org/ftp/gcrypt/libgcrypt/libgcrypt-${version}.tar.bz2"
stage = 5
depends = ["libgpg-error"]
build_commands = [
    "./configure --prefix=/usr",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libgcrypt.so"]

[packages.libksba]
version = "1.6.7"
version_check = "url:https://gnupg.org/ftp/gcrypt/libksba/|libksba-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "X.509 and CMS library"
url = "https://gnupg.org/ftp/gcrypt/libksba/libksba-${version}.tar.bz2"
stage = 5
depends = ["libgpg-error"]
build_commands = [
    "./configure --prefix=/usr",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libksba.so"]

[packages.libpsl]
version = "0.21.5"
version_check = "github:rockdaboot/libpsl"
description = "Public Suffix List library"
url = "https://github.com/rockdaboot/libpsl/releases/download/${version}/libpsl-${version}.tar.gz"
stage = 5
build_system = "meson"
provides = ["/usr/lib/libpsl.so"]

[packages.libseccomp]
version = "2.5.5"
version_check = "github:seccomp/libseccomp"
description = "Enhanced seccomp library"
url = "https://github.com/seccomp/libseccomp/releases/download/v${version}/libseccomp-${version}.tar.gz"
stage = 5
build_commands = [
    "./configure --prefix=/usr --disable-static",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libseccomp.so"]

[packages.libsoup3]
version = "3.6.4"
version_check = "gnome:libsoup"
description = "HTTP client/server library for GNOME (version 3)"
url = "https://download.gnome.org/sources/libsoup/3.6/libsoup-${version}.tar.xz"
source_dir = "libsoup-${version}"
stage = 9
depends = ["glib", "libpsl", "libxml2", "sqlite", "nghttp2", "glib-networking"]
skip_optimization = true
build_commands = [
    "meson setup build-pk/meson --prefix=/usr -Dtests=false -Dintrospection=disabled -Dvapi=disabled -Ddocs=disabled -Dsysprof=disabled",
    "ninja -C build-pk/meson",
    "DESTDIR=${PKG} ninja -C build-pk/meson install"
]
provides = ["/usr/lib/libsoup-3.0.so"]

[packages.libsndfile]
version = "1.2.2"
version_check = "github:libsndfile/libsndfile"
description = "C library for reading and writing sound files"
url = "https://github.com/libsndfile/libsndfile/releases/download/${version}/libsndfile-${version}.tar.xz"
git_url = "https://github.com/libsndfile/libsndfile.git"
use_git = false
stage = 8
build_system = "cmake"
skip_optimization = true
cmake_flags = "-DBUILD_TESTING=OFF -DENABLE_EXTERNAL_LIBS=OFF -DCMAKE_POLICY_VERSION_MINIMUM=3.5 -DBUILD_SHARED_LIBS=ON"

[packages.libdrm]
version = "2.4.131"
version_check = "freedesktop:mesa/drm"
description = "Direct Rendering Manager library"
url = "https://dri.freedesktop.org/libdrm/libdrm-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/mesa/drm.git"
use_git = false
stage = 8
build_system = "meson"

[packages.libdisplay-info]
version = "0.3.0"
version_check = "freedesktop:emersion/libdisplay-info"
description = "EDID and DisplayID parsing library"
url = "https://gitlab.freedesktop.org/emersion/libdisplay-info/-/releases/${version}/downloads/libdisplay-info-${version}.tar.xz"
stage = 8
build_system = "meson"

[packages.libwnck]
version = "43.3"
version_check = "gnome:libwnck"
description = "Window Navigator Construction Kit"
url = "https://download.gnome.org/sources/libwnck/43/libwnck-${version}.tar.xz"
stage = 8
build_system = "meson"
depends = ["gtk3", "libX11", "libXres"]
meson_flags = "-Dgtk_doc=false -Dintrospection=disabled"

[packages.libXdmcp]
version = "1.1.5"
version_check = "xorg:lib/libXdmcp"
description = "X Display Manager Control Protocol library"
url = "https://www.x.org/releases/individual/lib/libXdmcp-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxdmcp.git"
use_git = false
stage = 8

[packages.libglvnd]
version = "1.7.0"
version_check = "github:NVIDIA/libglvnd"
description = "GL Vendor-Neutral Dispatch library"
url = "https://gitlab.freedesktop.org/glvnd/libglvnd/-/archive/v${version}/libglvnd-v${version}.tar.gz"
git_url = "https://gitlab.freedesktop.org/glvnd/libglvnd.git"
use_git = false
stage = 8
build_system = "meson"
source_dir = "libglvnd-v${version}"

[packages.libepoxy]
version = "1.5.10"
version_check = "github:anholt/libepoxy"
description = "Library for handling OpenGL function pointer management"
url = "https://download.gnome.org/sources/libepoxy/1.5/libepoxy-${version}.tar.xz"
git_url = "https://github.com/anholt/libepoxy.git"
use_git = false
stage = 8
build_system = "meson"
depends = ["mesa", "libX11"]

[packages.libinput]
version = "1.30.1"
version_check = "freedesktop:libinput/libinput"
description = "Input device handling library"
url = "https://gitlab.freedesktop.org/libinput/libinput/-/archive/${version}/libinput-${version}.tar.gz"
git_url = "https://gitlab.freedesktop.org/libinput/libinput.git"
use_git = false
stage = 8
build_system = "meson"
meson_flags = "-Dlibwacom=false -Ddocumentation=false -Dtests=false -Ddebug-gui=false"
depends = ["libevdev", "mtdev"]

[packages.libevdev]
version = "1.13.6"
version_check = "freedesktop:libevdev/libevdev"
description = "Event device library"
url = "https://www.freedesktop.org/software/libevdev/libevdev-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/libevdev/libevdev.git"
use_git = false
stage = 8

[packages.libICE]
version = "1.1.2"
version_check = "xorg:lib/libICE"
description = "X11 Inter-Client Exchange library"
url = "https://www.x.org/releases/individual/lib/libICE-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libice.git"
use_git = false
stage = 8

[packages.libSM]
version = "1.2.6"
version_check = "xorg:lib/libSM"
description = "X11 Session Management library"
url = "https://www.x.org/releases/individual/lib/libSM-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libsm.git"
use_git = false
stage = 8

[packages.libxkbfile]
version = "1.2.0"
version_check = "xorg:lib/libxkbfile"
description = "XKB file handling library"
url = "https://www.x.org/releases/individual/lib/libxkbfile-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxkbfile.git"
use_git = false
stage = 8

[packages.libxshmfence]
version = "1.3.3"
version_check = "xorg:lib/libxshmfence"
description = "X shared memory fence library"
url = "https://www.x.org/releases/individual/lib/libxshmfence-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxshmfence.git"
use_git = false
stage = 8

[packages.libfontenc]
version = "1.1.8"
version_check = "xorg:lib/libfontenc"
description = "X font encoding library"
url = "https://www.x.org/releases/individual/lib/libfontenc-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libfontenc.git"
use_git = false
stage = 8

[packages.libXfont2]
version = "2.0.7"
version_check = "xorg:lib/libXfont2"
description = "X font handling library"
url = "https://www.x.org/releases/individual/lib/libXfont2-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxfont.git"
use_git = false
stage = 8

[packages.libxcvt]
version = "0.1.3"
version_check = "freedesktop:xorg/lib/libxcvt"
description = "VESA CVT modeline generation library"
url = "https://www.x.org/releases/individual/lib/libxcvt-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxcvt.git"
use_git = false
stage = 8
build_system = "meson"

[packages.libpciaccess]
version = "0.18.1"
version_check = "xorg:lib/libpciaccess"
description = "PCI access library"
url = "https://www.x.org/releases/individual/lib/libpciaccess-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libpciaccess.git"
use_git = false
stage = 8
build_system = "meson"

[packages.libXt]
version = "1.3.1"
version_check = "xorg:lib/libXt"
description = "X Toolkit Intrinsics library"
url = "https://www.x.org/releases/individual/lib/libXt-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxt.git"
use_git = false
stage = 8

[packages.libXtst]
version = "1.2.5"
version_check = "xorg:lib/libXtst"
description = "X Test Extension library"
url = "https://www.x.org/releases/individual/lib/libXtst-${version}.tar.xz"
stage = 8
build_system = "autotools"
depends = ["libX11", "libXext", "libXi"]

[packages.libXxf86vm]
version = "1.1.7"
version_check = "xorg:lib/libXxf86vm"
description = "XFree86 VidMode extension library"
url = "https://www.x.org/releases/individual/lib/libXxf86vm-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxxf86vm.git"
use_git = false
stage = 8
depends = ["libX11", "libXext", "xorgproto"]

[packages.libXmu]
version = "1.3.0"
version_check = "xorg:lib/libXmu"
description = "X miscellaneous utility library"
url = "https://www.x.org/releases/individual/lib/libXmu-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxmu.git"
use_git = false
stage = 8

[packages.libXaw]
version = "1.0.16"
version_check = "xorg:lib/libXaw"
description = "X Athena Widgets library"
url = "https://www.x.org/releases/individual/lib/libXaw-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxaw.git"
use_git = false
stage = 8

[packages.libXpm]
version = "3.5.18"
version_check = "xorg:lib/libXpm"
description = "X Pixmap library"
url = "https://www.x.org/releases/individual/lib/libXpm-${version}.tar.xz"
git_url = "https://gitlab.freedesktop.org/xorg/lib/libxpm.git"
use_git = false
stage = 8

[packages.libxkbcommon]
version = "1.13.1"
version_check = "github:xkbcommon/libxkbcommon"
description = "Keyboard keymap compiler and support library"
url = "https://github.com/xkbcommon/libxkbcommon/archive/refs/tags/xkbcommon-${version}.tar.gz"
source_dir = "libxkbcommon-xkbcommon-${version}"
git_url = "https://github.com/xkbcommon/libxkbcommon.git"
use_git = false
stage = 8
build_system = "meson"
depends = ["xkeyboard-config"]
meson_flags = "-Denable-docs=false -Denable-wayland=false -Denable-x11=true"
provides = ["/usr/lib/libxkbcommon.so"]

[packages.libxfce4util]
version = "4.20.1"
version_check = "xfce:xfce/libxfce4util"
description = "Xfce utility library"
url = "https://archive.xfce.org/src/xfce/libxfce4util/4.20/libxfce4util-${version}.tar.bz2"
git_url = "https://gitlab.xfce.org/xfce/libxfce4util.git"
use_git = false
stage = 9
build_order = 10
depends = ["glib"]
build_system = "autotools"

[packages.libxfce4ui]
version = "4.20.2"
version_check = "xfce:xfce/libxfce4ui"
description = "Xfce UI library"
url = "https://archive.xfce.org/src/xfce/libxfce4ui/4.20/libxfce4ui-${version}.tar.bz2"
git_url = "https://gitlab.xfce.org/xfce/libxfce4ui.git"
use_git = false
stage = 9
build_order = 12
depends = ["libxfce4util", "xfconf", "gtk3"]
build_system = "autotools"

[packages.libxfce4windowing]
version = "4.20.5"
version_check = "xfce:xfce/libxfce4windowing"
description = "Xfce windowing library"
url = "https://archive.xfce.org/src/xfce/libxfce4windowing/4.20/libxfce4windowing-${version}.tar.bz2"
git_url = "https://gitlab.xfce.org/xfce/libxfce4windowing.git"
use_git = false
stage = 9
build_order = 14
depends = ["libxfce4util", "gtk3"]
build_system = "autotools"

# STAGE 10: XFCE Desktop

[packages.liberation-fonts]
version = "2.1.5"
version_check = "github:liberationfonts/liberation-fonts"
description = "Liberation fonts (metric-compatible with Arial, Times, Courier)"
url = "https://github.com/liberationfonts/liberation-fonts/files/7261482/liberation-fonts-ttf-${version}.tar.gz"
source_dir = "liberation-fonts-ttf-${version}"
stage = 8
build_order = 3
build_commands = [
    "mkdir -p ${PKG}/usr/share/fonts/liberation",
    "install -m644 *.ttf ${PKG}/usr/share/fonts/liberation/"
]
provides = ["/usr/share/fonts/liberation/LiberationSans-Regular.ttf"]

# STAGE 14: Development Tools (heavy builds)

[packages.llvm]
version = "21.1.8"
version_check = "github:llvm/llvm-project"
description = "LLVM compiler infrastructure"
url = "https://github.com/llvm/llvm-project/releases/download/llvmorg-${version}/llvm-project-${version}.src.tar.xz"
git_url = "https://github.com/llvm/llvm-project.git"
use_git = false
stage = 14
# PGO: LLVM benefits ~15-20% from PGO (compile times decrease significantly)
# Stage 1: Build with instrumentation, Stage 2: Generate profiles, Stage 3: Build optimized
# Includes: clang, clang++, flang-new (with MLIR), lld, lldb, clang-tools-extra, compiler-rt
build_commands = [
    "mkdir -p build-stage1 && cd build-stage1 && cmake -G Ninja ../llvm -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS='clang;lld' -DLLVM_TARGETS_TO_BUILD='X86' -DCMAKE_INSTALL_PREFIX=/usr -DLLVM_BUILD_INSTRUMENTED=IR -DLLVM_BUILD_RUNTIME=No -DLLVM_INCLUDE_TESTS=OFF",
    "cd build-stage1 && ninja clang lld",
    "mkdir -p profiles && cd build-stage1 && LLVM_PROFILE_FILE=$(pwd)/../profiles/profile-%p.profraw bin/clang -O2 -c ../clang/lib/Sema/*.cpp 2>/dev/null || true",
    "build-stage1/bin/llvm-profdata merge -output=profdata.prof profiles/*.profraw",
    "mkdir -p build-pgo && cd build-pgo && cmake -G Ninja ../llvm -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS='clang;lld;clang-tools-extra;compiler-rt;mlir;flang;lldb;polly' -DLLVM_ENABLE_RUNTIMES='libcxx;libcxxabi;libunwind' -DLLVM_TARGETS_TO_BUILD='X86;RISCV;NVPTX;AMDGPU' -DCMAKE_INSTALL_PREFIX=/usr -DLLVM_PROFDATA_FILE=$(pwd)/../profdata.prof -DLLVM_ENABLE_LTO=Thin -DLLVM_PARALLEL_LINK_JOBS=2 -DFLANG_ENABLE_WERROR=OFF -DMLIR_ENABLE_BINDINGS_PYTHON=ON -DLLVM_INSTALL_UTILS=ON",
    "cd build-pgo && ninja",
    "cd build-pgo && DESTDIR=${PKG} ninja install"
]

# [packages.flang] - Now built as part of [packages.llvm] with full MLIR support
# Flang requires MLIR which is included in the unified LLVM build above
# This provides: flang-new (Fortran compiler), mlir-opt, mlir-translate, etc.

[packages.libva]
version = "2.23.0"
version_check = "github:intel/libva"
description = "VA-API video acceleration"
url = "https://github.com/intel/libva/releases/download/${version}/libva-${version}.tar.bz2"
git_url = "https://github.com/intel/libva.git"
use_git = false
stage = 16
build_order = 6
depends = ["libdrm", "libX11", "libXext", "libXfixes", "mesa"]
build_system = "meson"
meson_flags = "-Dwith_x11=yes -Dwith_wayland=no -Ddisable_drm=false"
provides = ["/usr/lib/libva.so", "/usr/lib/libva-drm.so", "/usr/lib/libva-x11.so"]

[packages.libavif]
version = "1.3.0"
version_check = "github:AOMediaCodec/libavif"
description = "AVIF image format library"
url = "https://github.com/AOMediaCodec/libavif/archive/v${version}/libavif-${version}.tar.gz"
git_url = "https://github.com/AOMediaCodec/libavif.git"
use_git = false
stage = 16

# STAGE 17: Document Processing (LaTeX, Pandoc)

[packages.lm-sensors]
version = "3-6-0"
version_check = "url:https://github.com/lm-sensors/lm-sensors/tags|V([0-9]+-[0-9]+-[0-9]+)"
description = "Hardware monitoring tools"
url = "https://github.com/lm-sensors/lm-sensors/archive/refs/tags/V${version}.tar.gz"
git_url = "https://github.com/lm-sensors/lm-sensors.git"
use_git = false
stage = 19

[packages.libpeas]
version = "1.36.0"
version_check = "skip:"
description = "Plugin engine for GNOME applications (1.x for gedit compatibility)"
url = "https://download.gnome.org/sources/libpeas/1.36/libpeas-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/libpeas.git"
use_git = false
stage = 9
build_order = 4
depends = ["gtk3", "gobject-introspection"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dvapi=false -Dglade_catalog=false -Ddemos=false -Dlua51=false -Dpython3=false"
provides = ["/usr/lib/libpeas-1.0.so", "/usr/lib/libpeas-gtk-1.0.so"]

[packages.libgedit-tepl]
version = "6.12.0"
version_check = "gnome:libgedit-tepl"
description = "Text editor product line library"
url = "https://download.gnome.org/sources/libgedit-tepl/${version_mm}/libgedit-tepl-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/World/gedit/libgedit-tepl.git"
use_git = false
stage = 9
build_order = 6
depends = ["gtk3", "libgedit-gtksourceview", "libgedit-amtk", "libgedit-gfls", "icu", "gobject-introspection"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dgobject_introspection=true"
provides = ["/usr/lib/libgedit-tepl-6.so", "/usr/share/gir-1.0/Tepl-6.gir"]

[packages.libgedit-gtksourceview]
version = "299.4.0"
version_check = "gnome:libgedit-gtksourceview"
description = "Source code editing widget for gedit"
url = "https://download.gnome.org/sources/libgedit-gtksourceview/299/libgedit-gtksourceview-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/World/gedit/libgedit-gtksourceview.git"
use_git = false
stage = 9
build_order = 2
depends = ["gtk3", "libxml2", "gobject-introspection"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dgobject_introspection=true"
provides = ["/usr/lib/libgedit-gtksourceview-300.so", "/usr/share/gir-1.0/GtkSource-300.gir"]

[packages.libgedit-amtk]
version = "5.9.0"
version_check = "gnome:libgedit-amtk"
description = "Actions, Menus and Toolbars Kit for GTK"
url = "https://download.gnome.org/sources/libgedit-amtk/${version_mm}/libgedit-amtk-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/World/gedit/libgedit-amtk.git"
use_git = false
stage = 9
build_order = 3
depends = ["gtk3", "gobject-introspection"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dgobject_introspection=true"
provides = ["/usr/lib/libgedit-amtk-5.so", "/usr/share/gir-1.0/Amtk-5.gir"]

[packages.libgedit-gfls]
version = "0.2.1"
version_check = "gnome:libgedit-gfls"
description = "GIO wrapper library for file loading and saving"
url = "https://download.gnome.org/sources/libgedit-gfls/${version_mm}/libgedit-gfls-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/World/gedit/libgedit-gfls.git"
use_git = false
stage = 9
build_order = 4
depends = ["glib", "gobject-introspection"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dgobject_introspection=true"
provides = ["/usr/lib/libgedit-gfls-1.so", "/usr/share/gir-1.0/Gfls-1.gir"]

[packages.libhandy]
version = "1.8.3"
version_check = "gnome:libhandy"
description = "GTK+ widgets for mobile UI"
url = "https://download.gnome.org/sources/libhandy/${version_mm}/libhandy-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/libhandy.git"
use_git = false
stage = 9
build_order = 5
depends = ["gtk3"]
skip_optimization = true
# GCC 16 + stack protector issue - must disable stack protector explicitly
build_commands = [
    "CFLAGS='-O2 -march=znver3 -fno-stack-protector' meson setup --prefix=/usr --libdir=lib -Dgtk_doc=false -Dintrospection=disabled -Dvapi=false -Dtests=false -Dexamples=false build-pk/meson",
    "ninja -C build-pk/meson -j${NPROC}",
    "DESTDIR=${PKG} ninja -C build-pk/meson install"
]
provides = ["/usr/lib/libhandy-1.so"]

[packages.libpipeline]
version = "1.5.8"
version_check = "url:https://download-mirror.savannah.gnu.org/releases/libpipeline/|libpipeline-([0-9]+\\.[0-9]+\\.[0-9]+)\\.tar"
description = "Library for manipulating pipelines of subprocesses"
url = "https://download-mirror.savannah.gnu.org/releases/libpipeline/libpipeline-${version}.tar.gz"
git_url = "https://gitlab.com/libpipeline/libpipeline.git"
use_git = false
stage = 4
build_order = 11
# Disable LTO - libtool issues with nm on LTO objects
build_commands = [
    "unset CFLAGS CXXFLAGS LDFLAGS && ./configure --prefix=/usr --disable-static CFLAGS='-O2 -march=znver3' LDFLAGS=''",
    "unset CFLAGS CXXFLAGS LDFLAGS && make -j${NPROC} CFLAGS='-O2 -march=znver3' LDFLAGS=''",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libpipeline.so"]

[packages.libevent]
version = "2.1.12"
version_check = "github:libevent/libevent"
description = "Event notification library"
url = "https://github.com/libevent/libevent/releases/download/release-${version}-stable/libevent-${version}-stable.tar.gz"
git_url = "https://github.com/libevent/libevent.git"
use_git = false
stage = 4
build_order = 10
source_dir = "libevent-${version}-stable"
depends = ["openssl"]
configure_flags = "--disable-static"
provides = ["/usr/lib/libevent.so"]

[packages.libreoffice]
version = "25.8.4"
version_check = "url:https://download.documentfoundation.org/libreoffice/stable/|([0-9]+\\.[0-9]+\\.[0-9]+)/"
description = "Free office suite (Writer, Calc, Impress, Draw, Base, Math)"
url = "https://download.documentfoundation.org/libreoffice/src/${version}/libreoffice-${version}.tar.xz"
git_url = "https://git.libreoffice.org/core"
use_git = false
stage = 14
# LibreOffice requires many dependencies and has a complex build
# See: https://wiki.documentfoundation.org/Development/BuildingOnLinux
depends = ["python", "gtk3", "curl", "nss", "nspr", "icu", "libxml2", "libxslt", "openssl", "zlib", "jpeg", "libpng"]
build_commands = [
    "./autogen.sh --prefix=/usr --with-parallelism=${NPROC} --disable-firebird-sdbc --without-java --without-help --without-doxygen --enable-release-build --with-system-libs",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/bin/libreoffice"]

[packages.libva-utils]
version = "2.23.0"
version_check = "github:intel/libva-utils"
description = "VA-API utilities (vainfo, etc.)"
url = "https://github.com/intel/libva-utils/releases/download/${version}/libva-utils-${version}.tar.bz2"
stage = 16
build_order = 7
depends = ["libva"]
build_system = "autotools"
provides = ["/usr/bin/vainfo"]

[packages.llama-cpp]
version = "b7865"
version_check = "github:ggml-org/llama.cpp"
description = "LLM inference in C/C++ with CUDA/Vulkan support"
url = "https://github.com/ggml-org/llama.cpp/archive/refs/tags/${version}.tar.gz"
git_url = "https://github.com/ggml-org/llama.cpp.git"
use_git = false
source_dir = "llama.cpp-${version}"
stage = 12
depends = ["cmake", "nvhpc"]
build_commands = [
    "source /etc/profile.d/nvhpc.sh",
    "cmake -B build -DGGML_CUDA=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr -DLLAMA_CURL=ON -DCMAKE_CUDA_COMPILER=/opt/nvidia/hpc_sdk/Linux_x86_64/25.11/cuda/bin/nvcc",
    "cmake --build build --config Release -j${NPROC}",
    "cmake --install build --prefix=${PKG}/usr",
    "mkdir -p ${PKG}/usr/lib",
    "cp build/lib*.so ${PKG}/usr/lib/ || true",
    "cp build/ggml/src/lib*.so ${PKG}/usr/lib/ || true"
]
provides = ["/usr/bin/llama-server", "/usr/bin/llama-cli"]

[packages.lm-studio]
version = "0.4.0-18"
version_check = "url:https://lmstudio.ai/download|LM Studio.*?([0-9]+\\.[0-9]+\\.[0-9]+)"
description = "LM Studio - local LLM inference with GUI and OpenAI-compatible API"
url = "https://installers.lmstudio.ai/linux/x64/${version}/LM-Studio-${version}-x64.AppImage"
source_dir = "."
stage = 12
build_commands = [
    "mkdir -p ${PKG}/opt/lm-studio ${PKG}/usr/bin ${PKG}/usr/share/applications",
    "cp LM-Studio-${version}-x64.AppImage ${PKG}/opt/lm-studio/lm-studio.AppImage",
    "chmod +x ${PKG}/opt/lm-studio/lm-studio.AppImage",
    "ln -sf /opt/lm-studio/lm-studio.AppImage ${PKG}/usr/bin/lm-studio",
    "cat > ${PKG}/usr/share/applications/lm-studio.desktop << 'DESKTOP'\n[Desktop Entry]\nName=LM Studio\nComment=Local LLM inference\nExec=/opt/lm-studio/lm-studio.AppImage\nIcon=lm-studio\nType=Application\nCategories=Development;Science;\nDESKTOP"
]
provides = ["/opt/lm-studio/lm-studio.AppImage", "/usr/bin/lm-studio"]
