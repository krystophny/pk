[packages.gobject-introspection]
version = "1.86.0"
version_check = "gnome:gobject-introspection"
description = "GObject introspection framework"
url = "https://download.gnome.org/sources/gobject-introspection/1.86/gobject-introspection-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gobject-introspection.git"
use_git = false
stage = 4
build_order = 41
depends = ["glib", "python"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dcairo=disabled"
provides = ["/usr/bin/g-ir-scanner", "/usr/lib/libgirepository-1.0.so"]

[packages.gdb]
version = "17.1"
version_check = "gnu:gdb"
description = "GNU Debugger"
url = "https://ftpmirror.gnu.org/gnu/gdb/gdb-${version}.tar.xz"
git_url = "https://sourceware.org/git/binutils-gdb.git"
use_git = false
stage = 4
depends = ["python", "readline", "ncurses", "expat", "zlib", "xz"]
build_commands = [
    "./configure --prefix=/usr --with-system-readline --with-python=/usr/bin/python3 --enable-tui --with-curses",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/bin/gdb"]

[packages.gcc]
version = "16-20260118"
version_check = "gcc-snapshot:"
description = "GNU Compiler Collection (development snapshot)"
url = "https://gcc.gnu.org/pub/gcc/snapshots/LATEST-16/gcc-${version}.tar.xz"
git_url = "git://gcc.gnu.org/git/gcc.git"
use_git = false
checksum_url = "https://gcc.gnu.org/pub/gcc/snapshots/LATEST-16/sha512.sum"
stage = 3
build_order = 25
depends = ["gmp", "mpfr", "mpc", "flex", "nvptx-tools", "newlib"]
languages = "c,c++,fortran"
# PGO+LTO: profiledbootstrap with BOOT_CFLAGS for LTO
# External LTO breaks symbol versioning - use GCC's BOOT_CFLAGS mechanism instead
skip_optimization = true
build_commands = [
    "case $(uname -m) in x86_64) sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64 ;; esac",
    "ln -sf /usr/src/newlib-*/newlib newlib",
    "(mkdir -p build && cd build && ../configure --prefix=/usr --enable-languages=c,c++,fortran,lto --enable-default-pie --enable-default-ssp --disable-multilib --with-system-zlib --enable-plugin --disable-werror --enable-threads=posix --enable-tls --enable-libgomp --enable-libatomic --enable-libquadmath --enable-libssp --enable-libstdcxx --enable-shared --enable-__cxa_atexit --enable-clocale=gnu --enable-lto --enable-checking=release --enable-offload-targets=nvptx-none --enable-offload-defaulted)",
    "(cd build && make -j${NPROC} BOOT_CFLAGS='-O3 -march=znver3 -mtune=znver3 -flto=auto -g' profiledbootstrap)",
    "(cd build && make DESTDIR=${PKG} install)",
    "cp -v ${PKG}/usr/include/c++/*/x86_64-pc-linux-gnu/bits/c++config.h ${PKG}/usr/include/c++/*/bits/c++config.h",
    "mkdir -p ${PKG}/usr/lib/bfd-plugins && (cd ${PKG}/usr/lib/bfd-plugins && ln -svf ../libexec/gcc/*/*/liblto_plugin.so .)",
    "ln -svf gcc ${PKG}/usr/bin/cc",
    "printf '#!/bin/sh\\nexec gcc -std=c99 \"$@\"\\n' > ${PKG}/usr/bin/c99 && chmod +x ${PKG}/usr/bin/c99",
    "ln -svf ../bin/cpp ${PKG}/usr/lib/cpp",
    "ln -svf gcc.1 ${PKG}/usr/share/man/man1/cc.1"
]

# GCC Pass 1 - Cross compiler (limited, for building glibc)
# Uses stable GCC 14.2 for reliable cross-compilation with glibc 2.40
# Build order: 2 (requires binutils-pass1)

[packages.gcc-pass1]
version = "16-20260118"
version_check = "gcc-snapshot:"
description = "GCC cross-compiler pass 1"
source_pkg = "gcc"
stage = 1
build_order = 2
depends = ["binutils-pass1"]
# Bootstrap phase - skip external optimization flags
skip_optimization = true
build_commands = [
    "tar -xf ${SOURCES}/mpfr-*.tar.xz && mv mpfr-* mpfr && tar -xf ${SOURCES}/gmp-*.tar.xz && mv gmp-* gmp && tar -xf ${SOURCES}/mpc-*.tar.* && mv mpc-* mpc",
    "case $(uname -m) in x86_64) sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64 ;; esac",
    "mkdir -p build && cd build && ../configure --target=${TARGET} --prefix=/var/tmp/lfs-bootstrap --with-glibc-version=2.40 --with-sysroot=${SYSROOT} --with-newlib --without-headers --enable-default-pie --enable-default-ssp --disable-nls --disable-shared --disable-multilib --disable-threads --disable-libatomic --disable-libgomp --disable-libquadmath --disable-libssp --disable-libvtv --disable-libstdcxx --enable-languages=c,c++ && make -j${NPROC} && make DESTDIR=${PKG} install && cat ../gcc/limitx.h ../gcc/glimits.h ../gcc/limity.h > $(dirname $(${PKG}/var/tmp/lfs-bootstrap/bin/${TARGET}-gcc -print-libgcc-file-name))/include/limits.h"
]

# Linux headers - can build in parallel with gcc-pass1
# Build order: 3 (no gcc dependency, but conventionally after)

[packages.glibc-pass1]
version = "2.40"
version_check = "gnu:glibc"
description = "GNU C Library (cross-built)"
source_pkg = "glibc"
stage = 1
build_order = 4
depends = ["gcc-pass1", "linux-headers"]
build_commands = [
    "mkdir -p build && cd build && echo 'rootsbindir=/usr/sbin' > configparms && ../configure --prefix=/usr --host=${TARGET} --build=$(../scripts/config.guess) --enable-kernel=5.4 --with-headers=${SYSROOT}/usr/include --disable-nscd --disable-werror libc_cv_slibdir=/usr/lib && make -j${NPROC} && make DESTDIR=${PKG} install",
    "case $(uname -m) in x86_64) mkdir -pv ${PKG}/lib64 && ln -sfv ../usr/lib/ld-linux-x86-64.so.2 ${PKG}/lib64/ld-linux-x86-64.so.2 && ln -sfv ../usr/lib/ld-linux-x86-64.so.2 ${PKG}/lib64/ld-lsb-x86-64.so.3 ;; esac",
    "sed '/RTLDLIST=/s@/usr@@g' -i ${PKG}/usr/bin/ldd"
]

# Final native glibc

[packages.glibc]
# Note: glibc 2.43 has SHADOW_STACK_POINTER_OFFSET build issues - staying on 2.40
version = "2.43"
version_check = "gnu:glibc"
description = "GNU C Library"
url = "https://ftpmirror.gnu.org/gnu/glibc/glibc-${version}.tar.xz"
git_url = "git://sourceware.org/git/glibc.git"
use_git = false
checksum_url = "https://ftpmirror.gnu.org/gnu/glibc/glibc-${version}.tar.xz.sig"
stage = 3
build_order = 7
# Note: glibc needs gettext, bison, perl, python to build
# LTO causes POINTER_GUARD undefined errors, so build_order < 10 disables it
build_commands = [
    "mkdir -p build && cd build",
    "echo 'rootsbindir=/usr/sbin' > configparms",
    "../configure --prefix=/usr --disable-werror --enable-kernel=5.4 --enable-stack-protector=strong --disable-nscd libc_cv_slibdir=/usr/lib",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install",
    "case $(uname -m) in x86_64) mkdir -pv ${PKG}/lib64 && ln -sfv ../usr/lib/ld-linux-x86-64.so.2 ${PKG}/lib64/ld-linux-x86-64.so.2 && ln -sfv ../usr/lib/ld-linux-x86-64.so.2 ${PKG}/lib64/ld-lsb-x86-64.so.3 ;; esac",
    "sed '/RTLDLIST=/s@/usr@@g' -i ${PKG}/usr/bin/ldd",
    "mkdir -pv ${PKG}/etc && cp -v ../nscd/nscd.conf ${PKG}/etc/nscd.conf"
]

# libstdc++ pass 1 - built with cross-compiler (temporary)
# Build order: 5 (requires glibc-pass1)

[packages.gcc-pass2]
version = "16-20260118"
version_check = "gcc-snapshot:"
description = "GCC cross-compiler pass 2"
source_pkg = "gcc"
stage = 2
provides = ["${SYSROOT}/usr/bin/cc"]
# Bootstrap phase - skip external optimization flags, but install LTO plugin for stage 3
skip_optimization = true
build_commands = [
    "tar -xf ${SOURCES}/mpfr-*.tar.xz && mv mpfr-* mpfr",
    "tar -xf ${SOURCES}/gmp-*.tar.xz && mv gmp-* gmp",
    "tar -xf ${SOURCES}/mpc-*.tar.* && mv mpc-* mpc",
    "case $(uname -m) in x86_64) sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64 ;; esac",
    "sed -i -e 's/^s-selftest-c++: .*/s-selftest-c++:/' -e '/GCC_FOR_SELFTESTS.*CPP_SELFTEST_FLAGS/d' gcc/cp/Make-lang.in",
    "mkdir -p build && cd build && ../configure --build=$(../config.guess) --host=${TARGET} --target=${TARGET} LDFLAGS_FOR_TARGET=-L${PWD}/${TARGET}/libgcc --prefix=/usr --with-build-sysroot=${SYSROOT} --enable-default-pie --enable-default-ssp --disable-nls --disable-multilib --disable-libatomic --disable-libgomp --disable-libquadmath --disable-libsanitizer --disable-libssp --disable-libvtv --enable-checking=release --enable-languages=c,c++ --enable-lto --enable-plugin && make -j${NPROC} all-gcc all-target-libgcc && make DESTDIR=${PKG} install-gcc install-target-libgcc",
    "ln -sv gcc ${PKG}/usr/bin/cc",
    "mkdir -p ${PKG}/usr/lib/bfd-plugins && (cd ${PKG}/usr/lib/bfd-plugins && ln -svf ../libexec/gcc/*/*/liblto_plugin.so .)"
]

[packages.gawk]
version = "5.3.2"
version_check = "gnu:gawk"
description = "GNU AWK"
url = "https://ftpmirror.gnu.org/gnu/gawk/gawk-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/gawk.git"
use_git = false
stage = 2
provides = ["${SYSROOT}/usr/bin/gawk"]
build_commands = [
    "sed -i 's/extras//' Makefile.in",
    "./configure --prefix=/usr --host=${TARGET} --build=$(./config.guess)",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.grep]
version = "3.12"
version_check = "gnu:grep"
description = "GNU grep"
url = "https://ftpmirror.gnu.org/gnu/grep/grep-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/grep.git"
use_git = false
stage = 2
provides = ["${SYSROOT}/usr/bin/grep"]
build_commands = [
    "./configure --prefix=/usr --host=${TARGET} --build=$(./config.guess)",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.gzip]
version = "1.14"
version_check = "gnu:gzip"
description = "GNU compression utility"
url = "https://ftpmirror.gnu.org/gnu/gzip/gzip-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/gzip.git"
use_git = false
stage = 2
provides = ["${SYSROOT}/usr/bin/gzip"]
build_commands = [
    "./configure --prefix=/usr --host=${TARGET} --build=$(./config.guess)",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.gperf]
version = "3.3"
version_check = "gnu:gperf"
description = "Perfect hash function generator"
url = "https://ftpmirror.gnu.org/gnu/gperf/gperf-${version}.tar.gz"
stage = 3
build_order = 1

[packages.gettext]
version = "0.26"
version_check = "gnu:gettext"
description = "GNU internationalization"
url = "https://ftpmirror.gnu.org/gnu/gettext/gettext-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/gettext.git"
use_git = false
stage = 3
build_order = 1
build_commands = [
    "./configure --prefix=/usr --disable-shared",
    "make -j${NPROC}",
    "mkdir -p ${PKG}/usr/bin",
    "cp -v gettext-tools/src/{msgfmt,msgmerge,xgettext} ${PKG}/usr/bin/"
]

[packages.gnutls]
version = "3.8.11"
version_check = "github:gnutls/gnutls"
description = "TLS library"
url = "https://www.gnupg.org/ftp/gcrypt/gnutls/v3.8/gnutls-${version}.tar.xz"
git_url = "https://gitlab.com/gnutls/gnutls.git"
use_git = false
stage = 4
build_order = 5
depends = ["nettle", "libtasn1", "libunistring", "gmp"]
build_commands = [
    "./configure --prefix=/usr --disable-static --without-p11-kit --with-default-trust-store-file=/etc/ssl/certs/ca-certificates.crt --disable-doc --disable-tests --disable-libdane",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.git]
version = "2.52.0"
version_check = "github:git/git"
description = "Distributed version control system"
url = "https://www.kernel.org/pub/software/scm/git/git-${version}.tar.xz"
git_url = "https://github.com/git/git.git"
use_git = false
stage = 4
build_order = 12
depends = ["curl", "openssl", "zlib", "expat"]
build_commands = [
    "make -j${NPROC} prefix=/usr gitexecdir=/usr/lib/git-core all",
    "make prefix=/usr gitexecdir=/usr/lib/git-core DESTDIR=${PKG} install"
]
provides = ["/usr/bin/git"]

[packages.grub]
version = "2.14"
version_check = "gnu:grub"
description = "GRand Unified Bootloader"
url = "https://ftpmirror.gnu.org/gnu/grub/grub-${version}.tar.xz"
git_url = "https://git.savannah.gnu.org/git/grub.git"
use_git = false
stage = 5
build_order = 5
# disable LTO - causes linker issues
build_commands = [
    "CFLAGS='-O2 -pipe' LDFLAGS='' ./configure --prefix=/usr --sysconfdir=/etc --disable-werror --disable-efiemu --disable-grub-mkfont --with-platform=efi --target=x86_64 --disable-grub-mount",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]

[packages.gmp]
version = "6.3.0"
version_check = "gnu:gmp"
description = "GNU Multiple Precision Arithmetic Library"
url = "https://ftpmirror.gnu.org/gnu/gmp/gmp-${version}.tar.xz"
git_url = "https://gmplib.org/repo/gmp/"
use_git = false
stage = 3
build_order = 17
build_commands = [
    "unset CFLAGS CXXFLAGS && CC='gcc -std=gnu17' ./configure --prefix=/usr --disable-cxx --docdir=/usr/share/doc/gmp-${version}",
    "make -j${NPROC}",
    "make html || true",
    "make DESTDIR=${PKG} install install-html || make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libgmp.so"]

[packages.glslang]
version = "16.2.0"
version_check = "github:KhronosGroup/glslang"
description = "Khronos GLSL/SPIR-V compiler"
url = "https://github.com/KhronosGroup/glslang/archive/refs/tags/${version}.tar.gz"
git_url = "https://github.com/KhronosGroup/glslang.git"
use_git = false
stage = 8
build_system = "cmake"
cmake_flags = "-DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DENABLE_OPT=OFF"
provides = ["/usr/bin/glslangValidator"]

[packages.glib]
version = "2.86.3"
version_check = "gnome:glib"
description = "GLib core library"
url = "https://download.gnome.org/sources/glib/2.86/glib-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/glib.git"
use_git = false
stage = 4
build_order = 40
depends = ["meson", "pcre2", "libffi", "zlib", "gobject-introspection"]
build_commands = [
    "meson setup build --prefix=/usr --buildtype=release -Dman-pages=disabled -Ddtrace=disabled -Dsystemtap=disabled -Dgtk_doc=false -Dintrospection=enabled -Dtests=false",
    "meson compile -C build",
    "DESTDIR=${PKG} meson install -C build"
]
provides = ["/usr/lib/libglib-2.0.so"]

[packages.gdk-pixbuf]
version = "2.44.4"
version_check = "gnome:gdk-pixbuf"
description = "Image loading library"
url = "https://download.gnome.org/sources/gdk-pixbuf/2.44/gdk-pixbuf-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gdk-pixbuf.git"
use_git = false
stage = 9
build_order = 6
build_system = "meson"
depends = ["shared-mime-info", "libjpeg-turbo", "libpng", "libtiff", "gobject-introspection"]
meson_flags = "-Dman=false -Dgtk_doc=false -Dintrospection=enabled -Dinstalled_tests=false -Dtests=false -Dbuiltin_loaders=none -Dglycin=disabled --wrap-mode=nodownload"
provides = ["/usr/lib/libgdk_pixbuf-2.0.so"]

[packages.google-chrome]
version = "stable"
version_check = "repology:google-chrome"
description = "Google Chrome browser (binary from Google)"
url = "https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb"
tarball = "google-chrome-stable_current_amd64.deb"
source_dir = "."
stage = 14
skip_optimization = true
build_commands = [
    # Extract .deb (ar archive containing data.tar.xz)
    "ar x /usr/src/google-chrome-stable_current_amd64.deb",
    "tar xf data.tar.xz -C ${PKG}",
    # Move files from /opt to /usr
    "mkdir -p ${PKG}/usr/lib",
    "mv ${PKG}/opt/google/chrome ${PKG}/usr/lib/google-chrome",
    "rmdir ${PKG}/opt/google ${PKG}/opt",
    # Create wrapper script
    "mkdir -p ${PKG}/usr/bin",
    "echo '#!/bin/sh' > ${PKG}/usr/bin/google-chrome",
    "echo 'exec /usr/lib/google-chrome/google-chrome \"$@\"' >> ${PKG}/usr/bin/google-chrome",
    "chmod +x ${PKG}/usr/bin/google-chrome",
    # Fix desktop file paths
    "sed -i 's|/opt/google/chrome|/usr/lib/google-chrome|g' ${PKG}/usr/share/applications/google-chrome.desktop"
]
provides = ["/usr/lib/google-chrome/google-chrome"]

[packages.gtk3]
version = "3.24.43"
version_check = "gnome:gtk+"
description = "GTK+ 3 toolkit"
url = "https://download.gnome.org/sources/gtk+/3.24/gtk+-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gtk.git"
use_git = false
stage = 9
build_order = 7
source_dir = "gtk+-${version}"
depends = ["pango", "cairo", "gdk-pixbuf", "atk", "libepoxy", "libxkbcommon", "gobject-introspection"]
# Fix NULL pointer crash in _gdk_x11_window_process_expose when antiexpose_area is NULL
build_commands = [
    "grep -q 'if (item->antiexpose_area) cairo_region_subtract' gdk/x11/gdkgeometry-x11.c || sed -i 's/cairo_region_subtract (invalidate_region, item->antiexpose_area);/if (item->antiexpose_area) cairo_region_subtract (invalidate_region, item->antiexpose_area);/' gdk/x11/gdkgeometry-x11.c",
    "meson setup build-pk/meson --prefix=/usr -Dman=false -Dgtk_doc=false -Dintrospection=true -Ddemos=false -Dexamples=false -Dtests=false -Dwayland_backend=false -Dbroadway_backend=false --wrap-mode=nodownload",
    "ninja -C build-pk/meson",
    "DESTDIR=${PKG} ninja -C build-pk/meson install"
]
provides = ["/usr/lib/libgtk-3.so"]

[packages.garcon]
version = "4.20.0"
version_check = "xfce:xfce/garcon"
description = "Xfce menu library"
url = "https://archive.xfce.org/src/xfce/garcon/4.20/garcon-${version}.tar.bz2"
git_url = "https://gitlab.xfce.org/xfce/garcon.git"
use_git = false
stage = 10
build_order = 1
depends = ["libxfce4ui", "libxfce4util", "gtk3"]
build_system = "autotools"

[packages.go]
version = "1.25.6"
version_check = "url:https://go.dev/dl/|go([0-9]+\\.[0-9]+\\.[0-9]+)\\.linux"
description = "Go programming language"
url = "https://go.dev/dl/go${version}.linux-amd64.tar.gz"
stage = 4
build_order = 50
source_dir = "go"
# Go is distributed as precompiled binaries - copy contents to /usr/local/go
build_commands = [
    "mkdir -p ${PKG}/usr/local/go",
    "cp -a bin pkg src lib misc api doc ${PKG}/usr/local/go/",
    "mkdir -p ${PKG}/usr/bin",
    "ln -sf ../local/go/bin/go ${PKG}/usr/bin/go",
    "ln -sf ../local/go/bin/gofmt ${PKG}/usr/bin/gofmt"
]

[packages.gh]
version = "2.86.0"
version_check = "github:cli/cli"
description = "GitHub CLI"
url = "https://github.com/cli/cli/archive/v${version}/cli-${version}.tar.gz"
source_dir = "cli-${version}"
stage = 4
build_order = 51
depends = ["go"]
build_commands = [
    "export PATH=/usr/local/go/bin:$PATH",
    "make",
    "mkdir -p ${PKG}/usr/bin",
    "cp bin/gh ${PKG}/usr/bin/"
]

[packages.gsettings-desktop-schemas]
version = "47"
version_check = "gnome:gsettings-desktop-schemas"
description = "GSettings desktop-wide schemas"
url = "https://download.gnome.org/sources/gsettings-desktop-schemas/${version}/gsettings-desktop-schemas-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gsettings-desktop-schemas.git"
use_git = false
stage = 8
build_order = 50
depends = ["glib"]
build_system = "meson"
meson_flags = "-Dintrospection=false"
triggers = ["glib-schemas"]
provides = ["/usr/share/glib-2.0/schemas/org.gnome.desktop.interface.gschema.xml"]

[packages.gspell]
version = "1.14.2"
version_check = "gnome:gspell"
description = "GNOME spell checking library"
url = "https://download.gnome.org/sources/gspell/1.14/gspell-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gspell.git"
use_git = false
stage = 9
build_order = 5
depends = ["gtk3", "enchant", "icu"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Dgobject_introspection=false -Dvapi=false -Dinstall_tests=false"
provides = ["/usr/lib/libgspell-1.so"]

[packages.gedit]
version = "48.1"
version_check = "github:GNOME/gedit"
description = "GNOME text editor"
url = "https://download.gnome.org/sources/gedit/48/gedit-${version}.tar.xz"
git_url = "https://gitlab.gnome.org/GNOME/gedit.git"
use_git = false
stage = 11
depends = ["gtk3", "gspell", "libpeas", "libgedit-tepl", "desktop-file-utils", "appstream-glib"]
build_system = "meson"
meson_flags = "-Dgtk_doc=false -Duser_documentation=false"
triggers = ["glib-schemas"]
provides = ["/usr/bin/gedit"]

[packages.gamemode]
version = "1.8.2"
version_check = "github:FeralInteractive/gamemode"
description = "Optimize Linux performance for gaming"
url = "https://github.com/FeralInteractive/gamemode/releases/download/${version}/gamemode-${version}.tar.xz"
git_url = "https://github.com/FeralInteractive/gamemode.git"
use_git = false
stage = 13

[packages.gamescope]
version = "3.16.19"
version_check = "github:ValveSoftware/gamescope"
description = "SteamOS session compositing window manager"
url = "https://github.com/ValveSoftware/gamescope/archive/refs/tags/${version}.tar.gz"
git_url = "https://github.com/ValveSoftware/gamescope.git"
use_git = false
stage = 13

# 32-bit Libraries (required for Steam/Wine)

[packages.ghc]
version = "9.14.1"
version_check = "github:ghc/ghc"
description = "Glasgow Haskell Compiler"
url = "https://downloads.haskell.org/~ghc/${version}/ghc-${version}-x86_64-deb11-linux.tar.xz"
git_url = ""
use_git = false
stage = 17
# Required for building Pandoc from source

[packages.ghostscript]
version = "10.06.0"
version_check = "url:https://github.com/ArtifexSoftware/ghostpdl-downloads/releases|ghostscript-([0-9]+\.[0-9]+\.[0-9]+)"
description = "PostScript/PDF interpreter"
url = "https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs10060/ghostscript-${version}.tar.xz"
git_url = ""
use_git = false
stage = 17

[packages.groff]
version = "1.23.0"
version_check = "gnu:groff"
description = "GNU troff text formatting system"
url = "https://ftpmirror.gnu.org/gnu/groff/groff-${version}.tar.gz"
git_url = "https://git.savannah.gnu.org/git/groff.git"
use_git = false
stage = 4
build_order = 9
# Disable LTO - C++ linking issues
build_commands = [
    "CFLAGS='-O2 -march=znver3' CXXFLAGS='-O2 -march=znver3' LDFLAGS='' ./configure --prefix=/usr --with-doc=no",
    "make -j${NPROC}",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/bin/groff", "/usr/bin/troff"]

[packages.gdbm]
version = "1.26"
version_check = "gnu:gdbm"
description = "GNU database manager"
url = "https://ftpmirror.gnu.org/gnu/gdbm/gdbm-${version}.tar.gz"
git_url = "https://git.savannah.gnu.org/git/gdbm.git"
use_git = false
stage = 4
build_order = 10
# Disable LTO - causes undefined reference errors during linking (wordwrap symbols)
# Must pass flags to make as well since system env leaks LTO
build_commands = [
    "unset CFLAGS CXXFLAGS LDFLAGS && ./configure --prefix=/usr --disable-static --enable-libgdbm-compat CFLAGS='-O2 -march=znver3' LDFLAGS=''",
    "unset CFLAGS CXXFLAGS LDFLAGS && make -j${NPROC} CFLAGS='-O2 -march=znver3' LDFLAGS=''",
    "make DESTDIR=${PKG} install"
]
provides = ["/usr/lib/libgdbm.so"]

# FPGA/EDA Tools

[packages.gtkwave]
version = "3.3.116"
version_check = "github:gtkwave/gtkwave"
description = "Waveform viewer for VCD, LXT, FST simulation dumps"
url = "https://github.com/gtkwave/gtkwave/archive/refs/tags/v${version}.tar.gz"
git_url = "https://github.com/gtkwave/gtkwave.git"
use_git = false
stage = 15
depends = ["gtk3", "tcl", "tk", "bzip2", "xz"]
build_system = "meson"
meson_flags = "-Dgtk=3"
provides = ["/usr/bin/gtkwave"]

# STAGE 18: Scientific Computing Languages
